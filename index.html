<!DOCTYPE html>
<html lang="hy">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ողջի գետի ջրի որակի վերլուծություն (P1–P7)</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body{font-family:Arial, sans-serif;background:#f4f6f8;margin:0}
    header{background:#0b7285;color:#fff;padding:18px 14px;text-align:center}
    header h1{margin:0;font-size:20px}
    header p{margin:8px 0 0;font-size:13px;opacity:.95}
    section{background:#fff;margin:14px;padding:16px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,.06)}
    h2{color:#0b7285;margin:0 0 10px}
    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    @media (min-width: 900px){.grid{grid-template-columns:1.1fr .9fr}}
    #map{height:350px;border-radius:10px}
    .controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    select{padding:8px 10px;border-radius:10px;border:1px solid #cfd8dc;background:#fff;min-width:260px}
    .note{font-size:13px;color:#37474f;line-height:1.45}
    footer{background:#dee2e6;text-align:center;padding:10px;margin-top:10px}
    canvas{max-height:420px}
    .badge{display:inline-block;background:#e3fafc;color:#0b7285;padding:4px 10px;border-radius:999px;font-size:12px;margin-left:6px}
  </style>
</head>
<body>

<header>
  <h1>Ողջի գետի ջրի որակի վերլուծություն — P1–P7</h1>
  <p>Ֆիզիկաքիմիական ցուցիչներ + աղային կազմ (SO₄²⁻, Cl⁻, NO₃⁻, Na/Mg/K/Ca, հանքայնացում)՝ քո տված տվյալներով</p>
</header>

<section>
  <h2>Քարտեզ և ընտրություն <span class="badge">Live գրաֆիկ</span></h2>
  <div class="grid">
    <div>
      <div id="map"></div>
      <p class="note" style="margin:10px 0 0;">
        Քարտեզի կետերի կոորդինատները հիմա դրված են “placeholder” (օրինակային)։ Եթե ուզես՝ կտաս կոնկրետ կոորդինատները, ու ես ճիշտ կտեղադրեմ։
      </p>
    </div>

    <div>
      <div class="controls">
        <label>
          Կետ (P1–P7)<br/>
          <select id="siteSelect"></select>
        </label>

        <label>
          Ցուցիչ<br/>
          <select id="paramSelect"></select>
        </label>
      </div>

      <p class="note" id="siteDesc" style="margin:12px 0 0;"></p>

      <div style="margin-top:12px;">
        <canvas id="chart"></canvas>
      </div>
    </div>
  </div>
</section>

<section>
  <h2>Նշում</h2>
  <p class="note">
    Եթե տվյալում կա «&lt;0.01» կամ «&lt;0.013», գրաֆիկում այն դրվում է որպես “չափման սահմանից ցածր” և չի գծվում որպես թիվ (որպեսզի սխալ թվային արժեք չստացվի)։
  </p>
</section>

<footer>Syune12 / vogji-water-quality</footer>

<script>
/* =========================
   1) Տվյալներ (P1–P7)
   =========================
   P1 — Ողջի ջրառ (Ֆոնային)
   P2 — Ողջի 2 (ազդեցությունից հետո)
   P3 — Բացահանքից եկող ջուր
   P4 — Բացահանքի ջրերը խառնվելուց հետո
   P5 — Սպիտակ ջուր 2 լցակույտ
   P6 — Ողջի՝ Սպիտակ ջուր խառնվելուց հետո
   P7 — Դարազամ/Ձորատեղ
*/

const sites = [
  {
    id:"P1",
    name:"P1 — Ողջի ջրառ (Ֆոնային)",
    desc:"Ֆոնային կետ՝ Ողջի ջրառ (քո աղյուսակից՝ 25.03–18.11.2025)",
    lat:39.205, lng:46.410,
    dates:["25.03.2025","22.04.2025","13.05.2025","17.06.2025","15.07.2025","12.08.2025","16.09.2025","14.10.2025","18.11.2025"],
    data:{
      "Թափանցիկություն (աստիճան)":[31,31,31,31,31,31,31,31,31],
      "Կախութային չոր նյութեր (բալ)":[12.5,36.1,16,6.3,8.8,10.8,9,17.7,3.2],
      "pH":[8.05,7.64,7.57,7.54,7.736,8.2,7.88,8.058,7.993],
      "Սուլֆատ իոն (մգ/լ)":[23.56,9.48,6.58,7.71,9.64,45.05,21.30,23.71,21.57],
      "Քլորիդ իոն (մգ/լ)":[6.23,2.16,1.38,1.22,1.11,4.51,3.53,3.98,3.88],
      "Նիտրատ իոն (մգ/լ)":[2.1888,2.419,1.5849,1.3139,0.495,0.33,0.535,0.653,1.321],
      "ԹԿՊ5 (մգ/լ)":[2.34,2.67,2.57,1.89,1.81,1.51,2.46,3.4,4.14],
      "Տեսակարար էլեկտրահաղորդականություն (µS/cm)":[314,140.9,83.2,82.6,119.4,402,227,257,261],
      "Na (մգ/լ)":[17.38,4.78,2.18,2.30,3.68,23.23,9.12,13.55,16.72],
      "Mg (մգ/լ)":[6.47,2.84,1.70,1.56,3.01,10.52,5.62,7.80,4.64],
      "K (մգ/լ)":[1.64,1.09,0.92,0.48,0.68,2.02,1.46,3.02,1.27],
      "Ca (մգ/լ)":[29.72,15.07,10.51,10.81,15.48,46.61,27.09,29.35,24.29],
      "ԸԼՆ / Հանքայնացում (մգ/լ)":[204,92,54,36.612,77.61,261.3,147.55,167.05,169.65]
    }
  },

  {
    id:"P2",
    name:"P2 — Ողջի 2 (ազդեցությունից հետո)",
    desc:"Կետ՝ ազդեցությունից հետո (քո աղյուսակից՝ 29.01–18.11.2025)",
    lat:39.190, lng:46.430,
    dates:["29.01.2025","25.03.2025","22.04.2025","13.05.2025","17.06.2025","15.07.2025","12.08.2025","16.09.2025","14.10.2025","18.11.2025"],
    data:{
      "Թափանցիկություն (աստիճան)":[31,1,1,9,7,31,0,31,31,31],
      "Կախութային չոր նյութեր (բալ)":[11.3,301.3,778,90.9,80.5,24.4,375.3,19.5,53.3,52.3],
      "pH":[8.06,8.17,8.02,7.86,7.75,8.32,7.728,7.75,7.807,7.869],
      "Սուլֆատ իոն (մգ/լ)":[316.55,222.78,325.30,60.56,36.46,321.66,321.53,341.22,260.80,318.22],
      "Քլորիդ իոն (մգ/լ)":[32.60,33.79,42.59,4.91,2.74,27.86,30.34,27.46,22.86,29.83],
      "Նիտրատ իոն (մգ/լ)":[12.56,7.22,11.27,3.13,3.13,11.33,4.30,12.26,16.54,20.48],
      "ԹԿՊ5 (մգ/լ)":[5.04,1.66,2.12,2.01,1.64,1.22,2.26,3.36,4.39,3.05],
      "Տեսակարար էլեկտրահաղորդականություն (µS/cm)":[876,1058,1197,307,213,914,944,883,825,1130],
      "Na (մգ/լ)":[22.83,65.92,33.83,6.26,7.64,48.14,49.68,56.69,28.90,57.98],
      "Mg (մգ/լ)":[45.054,25.077,45.219,7.163,6.004,36.358,40.848,32.702,41.691,33.242],
      "K (մգ/լ)":[5.541,4.045,6.841,1.721,1.055,6.566,6.367,5.076,8.781,5.412],
      "Ca (մգ/լ)":[110.32,89.37,146.72,30.12,21.55,112.29,100.34,92.11,89.26,111.83],
      "ԸԼՆ / Հանքայնացում (մգ/լ)":[569,688,778,199,57.969,594,613.6,573.95,536.25,734.5]
    }
  },

  {
    id:"P3",
    name:"P3 — Բացահանքից եկող ջուր",
    desc:"Բացահանքից եկող ջուր (քո աղյուսակից՝ 29.01–18.11.2025)",
    lat:39.175, lng:46.445,
    dates:["29.01.2025","25.03.2025","22.04.2025","13.05.2025","17.06.2025","15.07.2025","12.08.2025","16.09.2025","14.10.2025","18.11.2025"],
    data:{
      "Թափանցիկություն (աստիճան)":[31,31,31,31,31,31,31,31,31,31],
      "Կախութային չոր նյութեր (բալ)":[16.1,25.2,37.4,32.2,17.2,20,15.5,18.7,30.8,10.1],
      "pH":[8.23,8.21,7.88,7.97,8.09,7.951,7.868,8.06,8.223,8.152],
      "Սուլֆատ իոն (մգ/լ)":[1007.30,677.50,719.36,520.10,498.73,556.04,704.03,759.22,807.19,920.70],
      "Քլորիդ իոն (մգ/լ)":[13.86,37.58,15.19,37.37,36.47,11.88,12.08,14.32,14.80,15.04],
      "Նիտրատ իոն (մգ/լ)":[13.66,13.35,19.23,10.76,7.93,7.58,8.32,13.19,14.79,18.18],
      "ԹԿՊ5 (մգ/լ)":[4.86,2.64,2.93,2.23,1.7,1.4,1.85,3.26,3.38,3.96],
      "Տեսակարար էլեկտրահաղորդականություն (µS/cm)":[2322,2136,1984,1808,1804,1918,2028,2232,2246,2280],
      "Na (մգ/լ)":[12.45,12.48,8.83,7.18,6.49,7.96,11.14,9.76,13.50,17.93],
      "Mg (մգ/լ)":[159.68,108.46,100.51,92.48,93.34,97.24,112.33,128.56,147.84,117.51],
      "K (մգ/լ)":[6.257,3.841,4.386,4.605,4.002,4.933,5.416,5.238,9.119,5.179],
      "Ca (մգ/լ)":[314.25,208.08,205.30,178.17,183.67,167.52,197.15,223.14,250.03,262.29],
      "ԸԼՆ / Հանքայնացում (մգ/լ)":[1509,1388,1290,1176,347.814,1246,1318.2,1450.8,1459.9,1482]
    }
  },

  {
    id:"P4",
    name:"P4 — Բացահանքի ջրերը խառնվելուց հետո",
    desc:"Բացահանքի ջրերը խառնվելուց հետո (քո աղյուսակից՝ 29.01–18.11.2025)",
    lat:39.180, lng:46.460,
    dates:["29.01.2025","25.03.2025","22.04.2025","13.05.2025","17.06.2025","15.07.2025","12.08.2025","16.09.2025","14.10.2025","18.11.2025"],
    data:{
      "Թափանցիկություն (աստիճան)":[31,31,31,31,31,31,31,31,31,31],
      "Կախութային չոր նյութեր (բալ)":[13.8,22.4,42.1,31.7,10.1,14.9,9.2,14.5,29.2,3.2],
      "pH":[8.12,8.21,7.97,7.68,7.735,8.009,8.057,8.0,8.154,8.095],
      "Սուլֆատ իոն (մգ/լ)":[470.15,348.34,384.27,13.14,24.16,404.99,445.27,432.05,528.07,324.53],
      "Քլորիդ իոն (մգ/լ)":[13.22,23.34,7.86,1.47,1.33,7.22,8.84,9.67,10.75,8.90],
      "Նիտրատ իոն (մգ/լ)":[6.423,6.6672,9.583,2.0219,1.4568,3.194,4.403,4.974,6.929,5.73],
      "ԹԿՊ5 (մգ/լ)":[3.74,2.99,2.55,2.02,1.54,1.56,1.82,3.03,6.7803904,4.25],
      "Տեսակարար էլեկտրահաղորդականություն (µS/cm)":[1209,1215,1171,112,144,904,1312,958,5,938],
      "Na (մգ/լ)":[17.59,18.25,9.96,2.41,2.15,10.59,16.50,15.02,0.38,21.50],
      "Mg (մգ/լ)":[79.76,56.11,56.18,2.90,4.82,59.22,64.01,60.19,19.68,42.89],
      "K (մգ/լ)":[5.206,3.624,3.247,0.926,0.573,3.624,4.944,3.861,null,3.236],
      "Ca (մգ/լ)":[153.39,120.12,116.04,12.78,14.81,111.66,131.98,108.13,7.34,106.55],
      "ԸԼՆ / Հանքայնացում (մգ/լ)":[786,790,761,73,42.714,587,852.8,622.7,681.2,609.7]
    }
  },

  {
    id:"P5",
    name:"P5 — Սպիտակ ջուր 2 լցակույտ",
    desc:"Սպիտակ ջուր 2 լցակույտ (քո աղյուսակից՝ 29.01–18.11.2025)",
    lat:39.165, lng:46.480,
    dates:["29.01.2025","25.02.2025","25.03.2025","22.04.2025","13.05.2025","17.06.2025","15.07.2025","12.08.2025","16.09.2025","14.10.2025","18.11.2025"],
    data:{
      "Թափանցիկություն (աստիճան)":[31,31,31,2,31,31,31,31,31,31,31],
      "Կախութային չոր նյութեր (բալ)":[17,null,29.8,500.7,44.5,20.2,24.1,13.6,39.1,49.3,38.6],
      "pH":[8.19,8.08,8.26,8.13,8.13,8.06,7.799,7.91,7.999,8.088,8.161],
      "Սուլֆատ իոն (մգ/լ)":[1250.65,1216.87,563.21,252.00,201.37,508.94,588.76,837.57,1006.08,1078.94,1135.79],
      "Քլորիդ իոն (մգ/լ)":[48.93,54.48,67.35,52.37,33.90,57.14,36.11,37.45,39.65,42.42,44.53],
      "Նիտրատ իոն (մգ/լ)":[38.67,45.916,35.0225,16.42,8.5407,22.3663,13.042,18.293,37.284,49.764,56.404],
      "ԹԿՊ5 (մգ/լ)":[4.3,3.21,2.68,2.2,2.12,1.58,1.58,1.56,2.87,3.55,4.58],
      "Տեսակարար էլեկտրահաղորդականություն (µS/cm)":[2784,2708,1964,1049,1011,1942,2100,2454,2816,2752,2919],
      "Na (մգ/լ)":[31.29,27.84,25.61,14.18,10.90,15.87,24.56,21.74,20.55,30.23,44.97],
      "Mg (մգ/լ)":[187.74,179.71,98.26,50.54,46.60,95.49,115.44,120.76,135.12,189.52,156.68],
      "K (մգ/լ)":[7.327,5.491,3.994,3.156,3.817,4.122,7.099,7.114,5.448,10.751,5.962],
      "Ca (մգ/լ)":[318.69,297.26,178.50,107.33,96.82,177.10,217.02,252.49,266.41,273.75,303.68],
      "ԸԼՆ / Հանքայնացում (մգ/լ)":[1810,1760,1277,682,657,311.202,1366,1595.1,1830.4,1788.8,1897.35]
    }
  },

  {
    id:"P6",
    name:"P6 — Ողջի՝ Սպիտակ ջուր խառնվելուց հետո",
    desc:"Ողջի՝ Սպիտակ ջուր խառնվելուց հետո (քո աղյուսակից՝ 29.01–18.11.2025, որոշ ամսաթվերով)",
    lat:39.175, lng:46.505,
    dates:["29.01.2025","25.02.2025","25.03.2025","22.04.2025","17.06.2025","16.09.2025","14.10.2025","18.11.2025"],
    data:{
      "Թափանցիկություն (աստիճան)":[3,4,0,2,8,31,31,8],
      "Կախութային չոր նյութեր (բալ)":[49.5,70.4,3055,323.7,71.5,22.6,39.6,79],
      "pH":[7.54,8.16,8.05,7.49,7.89,7.8,7.771,7.969],
      "Սուլֆատ իոն (մգ/լ)":[275.39,264.28,225.17,334.57,67.74,344.15,260.42,292.97],
      "Քլորիդ իոն (մգ/լ)":[29.46,37.07,42.99,27.82,5.06,27.94,22.95,29.49],
      "Նիտրատ իոն (մգ/լ)":[0.372,0.529,5.411,0.345,4.1902,12.193,16.915,7.611],
      "ԹԿՊ5 (մգ/լ)":[8.78,5.88,1.03,5.77,1.44,3.51,5.7,8.41],
      "Տեսակարար էլեկտրահաղորդականություն (µS/cm)":[996,1094,867,1218,350,883,819,1359],
      "Na (մգ/լ)":[30.11,36.73,66.47,47.67,9.51,56.64,27.00,77.44],
      "Mg (մգ/լ)":[51.19,43.61,20.10,38.46,9.82,32.78,38.64,30.66],
      "K (մգ/լ)":[7.357,6.166,4.089,6.877,1.636,5.082,8.179,7.183],
      "Ca (մգ/լ)":[109.99,103.40,77.57,122.93,36.23,92.27,84.12,115.05],
      "ԸԼՆ / Հանքայնացում (մգ/լ)":[647,711,564,792,91.53,573.95,532.35,883.35]
    }
  },

  {
    id:"P7",
    name:"P7 — Դարազամ/Ձորատեղ",
    desc:"Դարազամ/Ձորատեղ (քո աղյուսակից՝ 29.01–18.11.2025)",
    lat:39.155, lng:46.520,
    dates:["29.01.2025","25.02.2025","25.03.2025","22.04.2025","13.05.2025","17.06.2025","15.07.2025","12.08.2025","16.09.2025","14.10.2025","18.11.2025"],
    data:{
      "Թափանցիկություն (աստիճան)":[31,3,31,4,31,31,31,31,31,31,31],
      "Կախութային չոր նյութեր (բալ)":[34.9,520.9,37.2,247.2,33,31.7,33.4,21.8,43.3,45.1,17.1],
      "pH":[8.18,8.09,8.22,8.07,8.04,8.06,7.987,7.998,8.017,8.105,8.096],
      "Սուլֆատ իոն (մգ/լ)":[1463.16,1410.75,815.97,538.89,495.10,723.14,885.74,1093.59,940.38,1130.79,1398.69],
      "Քլորիդ իոն (մգ/լ)":[45.98,42.72,61.56,52.88,64.72,61.22,42.38,42.73,37.64,44.31,46.25],
      "Նիտրատ իոն (մգ/լ)":[70.70,80.04,69.27,37.66,38.03,56.38,47.16,60.59,34.51,52.40,116.24],
      "ԹԿՊ5 (մգ/լ)":[3.33,3.34,3.09,2.44,2.26,2.08,1.62,2.21,3.31,3.11,4.41],
      "Տեսակարար էլեկտրահաղորդականություն (µS/cm)":[3048,2966,2810,1617,2006,2496,2806,2978,2834,2716,3396],
      "Na (մգ/լ)":[22.96,25.55,26.64,17.84,17.16,16.81,18.50,22.25,20.29,31.36,42.08],
      "Mg (մգ/լ)":[214.58,205.27,107.46,80.31,91.75,123.26,159.53,157.96,155.21,207.91,174.76],
      "K (մգ/լ)":[8.324,6.715,4.757,4.580,5.467,5.645,5.777,8.734,5.965,11.764,6.888],
      "Ca (մգ/լ)":[391.96,349.58,234.39,167.21,184.16,258.22,208.34,314.15,265.43,301.40,359.34],
      "ԸԼՆ / Հանքայնացում (մգ/լ)":[1981,1928,1827,1051,1304,305.1,1824,1935.7,1842.1,1765.4,2207.4]
    }
  }
];

/* =========================
   2) Օգնականներ
   ========================= */
function normalizeValue(v){
  if (v === null || v === undefined) return null;
  if (typeof v === "number") return v;
  const s = String(v).trim();
  if (s.startsWith("<")) return null; // չափման սահմանից ցածր
  const n = Number(s.replace(",", "."));
  return Number.isFinite(n) ? n : null;
}

function getAllParamsForSite(site){
  return Object.keys(site.data);
}

/* =========================
   3) Dropdown-ներ
   ========================= */
const siteSelect = document.getElementById("siteSelect");
const paramSelect = document.getElementById("paramSelect");
const siteDesc = document.getElementById("siteDesc");

sites.forEach(s=>{
  const opt=document.createElement("option");
  opt.value=s.id;
  opt.textContent=s.name;
  siteSelect.appendChild(opt);
});

function refreshParamOptions(){
  const site = sites.find(x=>x.id===siteSelect.value) || sites[0];
  const params = getAllParamsForSite(site);

  paramSelect.innerHTML = "";
  params.forEach(p=>{
    const opt=document.createElement("option");
    opt.value=p;
    opt.textContent=p;
    paramSelect.appendChild(opt);
  });

  siteDesc.textContent = site.desc;
}

/* =========================
   4) Chart.js
   ========================= */
const ctx = document.getElementById("chart").getContext("2d");
let chart;

function renderChart(){
  const site = sites.find(x=>x.id===siteSelect.value) || sites[0];
  const param = paramSelect.value;

  const labels = site.dates;
  const raw = site.data[param] || [];
  const values = raw.map(normalizeValue);

  if(chart) chart.destroy();

  chart = new Chart(ctx, {
    type: "line",
    data: {
      labels,
      datasets: [{
        label: `${site.name} — ${param}`,
        data: values,
        spanGaps: false,
        tension: 0.2
      }]
    },
    options: {
      responsive:true,
      maintainAspectRatio:false,
      plugins:{
        legend:{display:true},
        tooltip:{enabled:true}
      },
      scales:{
        x:{ticks:{maxRotation:45,minRotation:0}},
        y:{beginAtZero:false}
      }
    }
  });
}

/* =========================
   5) Leaflet քարտեզ
   ========================= */
const map = L.map("map").setView([39.18, 46.46], 11);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  attribution: "&copy; OpenStreetMap contributors"
}).addTo(map);

const markers = {};
sites.forEach(s=>{
  const m = L.marker([s.lat, s.lng]).addTo(map).bindPopup(`<b>${s.name}</b><br/>${s.desc}`);
  markers[s.id]=m;
});

function focusMarker(){
  const id = siteSelect.value;
  const m = markers[id];
  if(!m) return;
  map.setView(m.getLatLng(), 12);
  m.openPopup();
}

/* =========================
   6) Events
   ========================= */
siteSelect.addEventListener("change", ()=>{
  refreshParamOptions();
  renderChart();
  focusMarker();
});
paramSelect.addEventListener("change", renderChart);

/* =========================
   7) Start
   ========================= */
siteSelect.value = "P1";
refreshParamOptions();
renderChart();
focusMarker();
</script>

</body>
</html>
